<?php

$state = '...##..#..##.#....##.#..#.#.##.#.#.######..##.#.#.####.#..#...##...#....#....#.##.###..#..###...#...#.....';
$start = -3;
$patterns = [
	'#..#.' => '.',
	'.#..#' => '#',
	'..#.#' => '.',
	'.....' => '.',
	'.#...' => '#',
	'#..##' => '#',
	'..##.' => '#',
	'#.##.' => '#',
	'#.#.#' => '.',
	'###.#' => '#',
	'.####' => '.',
	'..###' => '.',
	'.###.' => '.',
	'#.#..' => '#',
	'###..' => '.',
	'##.#.' => '.',
	'##..#' => '.',
	'##.##' => '.',
	'#.###' => '.',
	'...##' => '#',
	'##...' => '#',
	'####.' => '.',
	'.#.##' => '.',
	'#...#' => '#',
	'.#.#.' => '#',
	'....#' => '.',
	'.##..' => '.',
	'...#.' => '.',
	'..#..' => '.',
	'#....' => '.',
	'.##.#' => '#',
	'#####' => '#',
];
/*$patterns = [
	'...##' => '#',
	'..#..' => '#',
	'.#...' => '#',
	'.#.#.' => '#',
	'.#.##' => '#',
	'.##..' => '#',
	'.####' => '#',
	'#.#.#' => '#',
	'#.###' => '#',
	'##.#.' => '#',
	'##.##' => '#',
	'###..' => '#',
	'###.#' => '#',
	'####.' => '#',
];*/
echo str_pad("0: ", 4, " ", STR_PAD_LEFT) . str_pad($state, 140, "_", STR_PAD_LEFT);
echo PHP_EOL;

for ($i=0; $i<200; $i++) {
	$newState = $state;
	for ($pos = 2; $pos<strlen($state)-2; $pos++) {
		foreach($patterns as $pattern => $result) {
			if (substr($state, $pos-2, 5) === $pattern) {
				$newState[$pos] = $result;
				break;
			} else {
				$newState[$pos] = '.';
			}
		}
	}
	$firstHash = strpos($newState, '#');
	$lastHash = strrpos($newState, '#');
	// ...##
	// ..#..
	// .#...
	if ($firstHash = 3) {
		$newState = '.' . $newState;
		$start--;
		//echo "added";
	}
	if ($lastHash >= strlen($newState) - 4) {
		$newState = $newState . '.';
	}
	$state = "$newState";
	echo str_pad("$i: ", 4, " ", STR_PAD_LEFT) . sum($state, $start) . " " . str_pad($state, 140, "_", STR_PAD_LEFT);
	echo PHP_EOL;



}

echo "$i: " . $state . PHP_EOL;
echo sum($state, $start);

// part 2
// 50,000,000,000 - 200 (iteration where patern repeats) * 33 (difference between each iteration) + 6655 (sum of the 200th iteration)
function sum($state, $start) {
	$sum = 0;
//echo $start;
	for ($i = 0; $i< strlen($state); $i++) {
		if($state[$i] == "#") {
			$sum += $start;
			//echo "$sum/$start, ";
		}
		$start++;
	}
	return $sum;
}

#......#....#........#....#....#....#....#........#....#........#....#.....#..........#....#....#....#....#....#....#....#....#..........#........#....#....#........#....#....#....#..#......#....#...
#......#....#........#....#....#....#....#........#....#........#....#.....#..........#....#....#....#....#....#....#....#....#..........#........#....#....#........#....#....#....#..#......#....#...
#......#....#........#....#....#....#....#........#....#........#....#.....#..........#....#....#....#....#....#....#....#....#..........#........#....#....#........#....#....#....#..#......#....#...